function Bimap(t,e){this._l2r={},this._r2l={},"function"==typeof e&&(this.getKeyOf=e),Array.isArray(t)&&t.forEach(function(t){this.insert(t[0],t[1])},this)}function Bipartite(t,e,r){"undefined"==typeof t&&(t=[]),"function"==typeof e&&(this.getKeyOf=e),this._autoRemoveIsolatedNodes=void 0===typeof r?!1:r,this._l2r={},this._r2l={},this.addEdges(t)}function norm(t){return Math.sqrt(numeric.sum(numeric.pow(t,2)))}function nthRow(t,e){return t[e-1]}function nthColumn(t,e){return t.map(function(t){return[t[e-1]]})}function ix(t,e,r){var o=size(t,1),n=size(t,2);":"===e&&(e=array1d(o,function(t){return t+1})),":"===r&&(r=array1d(n,function(t){return t+1}));var i=e.length,s=r.length,a=array2d(i,s,0);return e.forEach(function(e,o){var n=e-1;r.forEach(function(e,r){var i=e-1;a[o][r]=t[n][i]})}),a}function ixUpdate(t,e,r,o){var n=size(t,1),i=size(t,2);":"===e&&(e=array1d(n,function(t){return t+1})),":"===r&&(r=array1d(i,function(t){return t+1}));var s=e.length,a=r.length;"number"==typeof o&&(o=array2d(s,a,o));var u=cloneDeep(t);return e.forEach(function(t,e){var n=t-1;r.forEach(function(t,r){var i=t-1;u[n][i]=o[e][r]})}),u}function colon(t,e,r){"number"!=typeof r&&(r=1);var o=[],n=t;if(r>0)for(;e>=n;)o.push(n),n+=r;else{if(!(0>r))throw new Error("colon(): step must not equals to 0.");for(;n>=e;)o.push(n),n+=r}return o}function size(t,e){return 1===e?t.length:2===e?t[0].length:[t.length,t[0].length]}function vecEquals(t,e,r){if(!_.isArray(t)||!_.isArray(e))return!1;if(t.length!==e.length)return!1;if(0===t.length)return!1;var o,n=t.length;for(o=0;n>o;++o)if("number"!=typeof t[o])return!1;for(o=0;n>o;++o)if("number"!=typeof e[o])return!1;var i=r||vecEquals.TOLERANCE,s=numeric.sub(t,e),a=numeric.norm2(s);if(0===a)return!0;var u=a/numeric.norm2(e);return i>u}function array2dEquals(t,e,r){if(t.length!==e.length)return!1;var o=t.length;if(0===o)return!1;var n=t[0].length||0;if(0===n)return!1;if(!e||!e[0]||e[0].length!==n)return!1;var i="number"==typeof r?r:array2dEquals.TOLERANCE,s=numeric.sub(t,e),a=numeric.norm2(s);if(0===a)return!0;var u=a/numeric.norm2(e);return i>u}function ccsValueListIterator(t){var e=t[0],r=t[1],o=t[2],n=o.length,i=0,s=0;return{hasNext:function(){return n>i},next:function(){var t,n,a,u;t=r[i],n=s,a=o[i],u=[t,n,a];var p=e[s+1];return++i,i>=p&&++s,u}}}function isMatrixLikeArray(t){if(!_.isArray(t))return!1;if(t.length<=0)return!1;if(!_.isArray(t[0]))return!1;var e=t.length,r=t[0].length;if(0>=r)return!1;var o;for(o=1;e>o;++o)if(!_.isArray(t[o])||t[o].length!==r)return!1;return!0}function matrixSize(t){return[t.length,t[0].length]}function DenseMatrix(t,e,r){if("number"==typeof t&&t>0&&"number"==typeof e&&e>0)this._m=t,this._n=e,this._data=_.array2d(t,e,"undefined"!=typeof r?r:0);else if(isMatrixLikeArray(t)){this._data=_.cloneDeep(t);var o=matrixSize(t);this._m=o[0],this._n=o[1]}else{if(!(t instanceof DenseMatrix))throw new Error("DenseMatrix(m, n): m and n must be positive integer.");this._m=t._m,this._n=t._n,this._data=_.cloneDeep(t._data)}}function ensureMatrixDimension(t,e,r){var o=new DenseMatrix(t);if(null!==e&&o.m()!==e)throw new Error("ensureMatrixDimension(mat, m, n): mat.m = "+o.m()+" but expect m = "+e);if(null!==r&&o.n()!==r)throw new Error("ensureMatrixDimension(mat, m, n): mat.n = "+o.n()+" but expect n = "+r);return t}function DokSparseMatrix(t,e,r){if((0|e)!==e||0>=e||(0|r)!==r||0>=r)throw new Error("DokSparseMatrix(ijvLst, m, n): m, n must be positive integer.");this._m=e,this._n=r,this._dict={};var o=_.noopIterator;_.isArray(t)?o=_.iteratorFromList(t):_.isIterator(t)&&(o=t);for(var n,i,s,a;o.hasNext();)n=o.next(),i=n[0],s=n[1],a=n[2],this.set_(i,s,a)}function SparseVector(t,e){if((0|e)!==e||0>=e)throw new Error("SparseVector(valueList, dimension): dimension must be positive integer.");this._dim=e,this._dict={};var r=_.noopIterator;_.isArray(t)?r=_.iteratorFromList(t):_.isIterator(t)&&(r=t);for(var o,n,i;r.hasNext();)o=r.next(),n=o[0],i=o[1],0!==i&&this.set_(n,i)}function mldivide(t,e){if(t instanceof DokSparseMatrix&&e instanceof SparseVector)return t.solveSparseVector(e);if(t instanceof DokSparseMatrix&&_.isArray(e))return t.solveVector(e);throw new Error("mldivide(A, b): unsupported type A or b. A, b: "+t+", "+e)}function eye(t){return array2d(t,t,function(t,e){return t===e?1:0})}function SetStore(t,e,r,o){function n(t){return"string"==typeof t?t:i.getKeyOf(t)}this._items={},this._byLabels=new Bimap([],n),this._byTypes={},"function"==typeof e&&(this.getKeyOf=e),"function"==typeof r&&(this.setKeyOf=r),"function"==typeof o&&(this.getTypeOf=o),Array.isArray(t)&&t.forEach(function(t){this.insert(t)},this);var i=this}function array1d(t,e){return Array.apply(null,Array(t)).map("function"==typeof e?function(t,r){return e(r)}:function(){return e})}function array2d(t,e,r){return"function"==typeof r?array1d(t,function(t){return array1d(e,function(e){return r(t,e)})}):array1d(t,function(){return array1d(e,r)})}function embed(t,e){var r,o,n;if(_.isArray(t)&&"number"==typeof e){for(n=array1d(e,0),r=0,o=t.length<e?t.length:e;o>r;++r)n[r]=t[r];return n}throw new Error("embed(vec, dim): vec must be a Javascript array.")}function byLexical(t,e){for(var r,o=0,n=t.length;n>o;){if(r=t[o]-e[o],0!==r)return r;++o}return r}function rotateLeft(t,e){if("undefined"==typeof e)throw new Error("rotateLeft(): no offset specified.");for(var r=t.length,o=new Array(r),n=(r+e%r)%r,i=0;r>i;)o[i]=t[(n+i)%r],++i;return o}function rotateRight(t,e){return rotateLeft(t,-e)}function minIndex(t){return _.reduce(t,function(t,e,r){return e<t.value&&(t.value=e,t.index=r),t},{value:1/0,index:-1}).index}function isIterator(t){return t&&"function"==typeof t.hasNext&&"function"==typeof t.next}function listFromIterator(t){for(var e=[];t.hasNext();)e.push(t.next());return e}function iteratorFromList(t){if(!_.isArray(t))throw new Error("iteratorFromList(lst): lst must be an array.");var e=0,r=t.length;return{hasNext:function(){return r>e},next:function(){return t[e++]}}}function uuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,r="x"==t?e:3&e|8;return r.toString(16)})}function normalizedCell(t){var e=minIndex(t);return rotateLeft(t,e)}function noop(){}function defineContract(t,e){return"dev"===_._env?function(){try{t.apply(null,arguments)}catch(r){throw"function"==typeof e&&(r.message=e.apply(null,arguments)+"\n"+r.message),e&&(r.message=e+"\n"+r.message),r}}:noop}function matrixOfDimension(t,e,r){return"*"!==t&&assert.positive(t),"*"!==e&&assert.positive(e),r||(r="input is not a matrix of "+t+" x "+e+"."),defineContract(function(r){assert.array(r,"mat is not a JS array"),"*"===t&&(t=r.length),assert(r.length===t,"mat length "+r.length+" is not "+t);var o,n;for(o=0;t>o;++o)for(assert.array(r[o],"row "+o+" is not a JS array"),"*"===e&&(e=r[o].length),assert(r[o].length===e,"row "+o+" has "+r[o].length+" elements instead of "+e),n=0;e>n;++n)assert.number(r[o][n],"mat("+[o,n]+") is not a number.")},r)}function isMatrixOfDimension(t,e,r){try{matrixOfDimension(e,r)(t)}catch(o){return!1}return!0}function vectorOfDimension(t,e){return"*"!==t&&assert.positive(t),e||(e="input is not a vector of "+t+" dimension."),defineContract(function(e){assert.array(e,"vec is not a JS array"),"*"===t&&(t=e.length),assert(e.length===t,"vec length "+e.length+" is not "+t);var r;for(r=0;t>r;++r)assert.number(e[r],"vec("+r+"): "+e[r]+" is not a number.")},e)}function isVectorOfDimension(t,e){try{vectorOfDimension(e)(t)}catch(r){return!1}return!0}function EBC(t){if(check["function"](t.id))this._idIterFn=t.id;else if("all"===t.id)this._idIterFn=function(t){var e=0,r=t.nfens();return{hasNext:function(){return r>e},next:function(){return++e}}};else if(check.array(t.id))this._idIterFn=function(){return iteratorFromList(t.id)};else{if(!check.number(t.id))throw new Error("EBC(): options.id is not valid.");this._idIterFn=function(){return iteratorFromList([t.id])}}if(check.array(t.value))this._valFn=function(e,r,o){return t.value[o]};else if(check.number(t.value))this._valFn=function(){return t.value};else{if(!check["function"](t.value))throw new Error("EBC(): options.value is not valid.");this._valFn=t.value}if(check.number(t.dir))this._dirs=[t.dir];else{if(!check.array(t.dir))throw new Error("EBC(): options.dir is not valid.");this._dirs=t.dir}}function Feblock(){}function DeforSS(t){_input_contract_deforss_option(t),this._mater=t.material,this._gcells=t.gcells,this._ir=t.integrationRule,check.assigned(t.rm)&&(this._rm=t.rm);var e=this._gcells.dim();switch(e){case 1:this.hBlmat=this._blmat1;break;case 2:if(this._gcells.axisSymm())throw new Error("DeforSS::hBlmat() for axixSymm, dim = "+e+" is not implemented.");this.hBlmat=this._blmat2;break;default:throw new Error("DeforSS::hBlmat() for dim "+e+" is not implemented.")}}function FeObject(){this._uid=this.generateUid()}function __node__(){}function FeNode(t,e,r,o){FeObject.call(this),t=parseFloat(t),e=parseFloat(e),r=parseFloat(r),this.x=isNaN(t)?0:t,this.y=isNaN(e)?0:e,this.z=isNaN(r)?0:r,this._model=o}function FeNodeProperty(t){FeObject.call(this),this._values={spc:new FeSPC,forceLoad:new FeNodalLoad,dispLoad:new FeNodalLoad},this._values.forceLoad.setType("force"),this._values.dispLoad.setType("disp"),this._model=t}function FeSPC(){FeObject.call(this),this._comps=repeat(null,6)}function FeNodalLoad(){FeObject.call(this),this._type="",this._values=repeat(0,6)}function FeElement(t,e){FeObject.call(this),this._nodes=t.slice(),this._model=e;var r=e._nodeEleGraph;this._nodes.forEach(function(t){r.addEdge(t,this)},this)}function FeElementProperty(t){FeObject.call(this),this._model=t}function TrussElementProperty(t,e,r){FeElementProperty.call(this,t),this.A=e,this.E=r}function FeTimeSeries(t){FeObject.call(this),this._model=t,this._type="",this._factor=1,this._params={},this.setType("Linear")}function FePattern(t,e){FeObject.call(this),this._ts=t,this._model=e}function FePlainPattern(t,e){FePattern.call(this,t,e),this._nodeProps={},this._eleProps={},this._nodalLoads={},this._nodalLoadGraph=new Bipartite([],getId,!1),this._eleLoads={},this._eleLoadGraph=new Bipartite([],getId,!1)}function FeModel(){FeObject.call(this),this._objects=new SetStore([],getId,setId,getTypeOf),this._nodeEleGraph=new Bipartite([],getId,!1),this._nodePropGraph=new Bipartite([],getId,!1),this._elePropGraph=new Bipartite([],getId,!1),this._patternPropGraph=new Bipartite([],getId,!1),this._timeSeriesPatternMap=new Bimap([],getId)}function __helpers__(){}function uuid(){var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx";return t.replace(/[xy]/g,function(t){var e=16*Math.random()|0,r="x"==t?e:3&e|8;return r.toString(16)})}function NotImplementedError(t){this.name="NotImplementedError",this.message=t,this.stack=(new Error).stack}function getId(t){return"string"==typeof t||"number"==typeof t?t:t&&"object"==typeof t&&"function"==typeof t.uid?t.uid():"undefined"!=typeof t._uid?t._uid:""}function setId(t,e){this.contains(t)&&(this.erase(t),t._uid=e,this.insert(t))}function getTypeOf(t){return t&&"function"==typeof t.getType?t.getType():"string"==typeof t?"string":"number"==typeof t?"number":Array.isArray(t)?"array":"function"==typeof t?"function":"object"==typeof t?"object":""}function repeat(t,e){for(var r=new Array(e);e--;)r[e]=t;return r}function addToSet(t,e){return-1===t.indexOf(e)?(t.push(e),!0):!1}function uniq(t,e,r){return e||(e=function(t){return t}),r||(r={}),t.filter(function(t){var o=e(t);return r[o]?!1:(r[o]=!0,!0)})}function clone(t,e){if(t&&"function"==typeof t.clone)return t.clone();if(Array.isArray(t))return t.slice();if("object"==typeof t){var r,o={};if(e===!0)for(r in t)t.hasOwnProperty(r)&&(o[r]=t[r]);else for(r in t)t.hasOwnProperty(r)&&(o[r]=clone(t[r]));return o}return t}function FeNodeSet(t){this._xyz=check.instance(t.xyz,PointSet)?t.xyz.clone():new PointSet(t.xyz)}function genISORm(t,e){var r=size(e),o=r[0],n=r[1];if(o===n)return eye(o);var i=e.map(function(t){return[t[0]]});switch(i=div(i,norm2(i)),n){case 1:return i;case 2:throw new Error("genISORm: ntan = "+n+" is not implemented.");default:throw new Error("genISORm: incorrect size of tangents, ntan = "+n)}}function skewmat(t){var e,r=t.length;if(3===r)e=[[0,-t[2],t[1]],[t[3],0,-t[0]],[-t[1],t[0],0]];else{if(2!==r)throw new Error("skewmat(theta): theta must be a vector of 2 or 3.");e=[-t[1],t[0]]}return e}function Field(t){if(_input_contract_field_option_(t),check.assigned(t.values)?this._values=new PointSet(t.values):check.assigned(t.pointset)?this._values=t.pointset.clone():check.assigned(t.fens)?this._values=new PointSet(t.fens.xyz()):check.assigned(t.nfens)&&check.assigned(t.dim)&&(this._values=new PointSet(t.nfens,t.dim)),check.assigned(t.ebcs)){var e=array2d(this.nfens()+1,this.dim()+1,!1),r=array2d(this.nfens()+1,this.dim()+1,0);this._prescribed=e,this._prescribedValues=r,t.ebcs.forEach(function(t){t.applyToField_(this)},this)}this._eqnums=null,this._neqns=-1}function GCellSet(t){var e=t.getCellSizeInDim(t.getDim()),r=this.cellSize();if(e!==r)throw new Error("GCellSet(): cellSize of the topology dismatch.");var o=t.getDim(),n=this.dim();if(o!==n)throw new Error("GCellSet(): dim of the topology dismatch.");this._id=uuid(),this._topology=t}function subset(t,e){var r=[];return e.forEach(function(e){return r.push(t[e])}),r}function Manifold1GCellSet(t,e,r){this._otherDimension="number"==typeof e||"function"==typeof e?e:1,this._axisSymm="undefined"!=typeof r?!!r:!1,GCellSet.call(this,t)}function Manifold2GCellSet(t,e,r){this._otherDimension="number"==typeof e||"function"==typeof e?e:1,this._axisSymm="undefined"!=typeof r?!!r:!1,GCellSet.call(this,t)}function L2(t){_input_contract_L2_(t);var e=t.conn,r=check.assigned(t.otherDimension)?t.otherDimension:1,o=check.assigned(t.axisSymm)?t.axisSymm:!1,n=hypercube(e,1);Manifold1GCellSet.call(this,n,r,o)}function Q4(t){var e=t.conn,r=check.assigned(t.otherDimension)?t.otherDimension:1,o=check.assigned(t.axisSymm)?t.axisSymm:!1,n=hypercube(e,2);Manifold2GCellSet.call(this,n,r,o)}function PointSet(){function t(t){return _.reduce(t,function(t,e){return e.length>t&&(t=e.length),t},0)}var e,r=Array.prototype.slice.call(arguments),o=r.length;if(1===o&&_.isArray(r[0])){if(0===r[0].length)throw new Error("PointSet() Can not determin pointset dimension from []");e=r[0],this._rn=t(e)}else if(2===o&&"number"==typeof r[0]&&"number"==typeof r[1])e=_.array2d(r[0],r[1],0),this._rn=t(e);else if(2===o&&"number"==typeof r[0]&&"function"==typeof r[1])e=_.array1d(r[0],r[1]),this._rn=t(e);else{if(2!==o||!_.isArray(r[0])||"number"!=typeof r[1])throw new Error("PointSet() can not initialize with args: "+r);e=r[0],this._rn=r[1]}this._points=new Array(e.length),_.each(e,function(t,e){var r=_.array1d(this._rn,0);_.each(t,function(t,e){r[e]=t}),this._points[e]=r},this)}function Topology(t,e){if(!_.isArray(t))throw new Error("Topology(): complexes must be a list of connectiviy list.");var r,o,n,i,s,a,u,p,c;for(i=t.length,r=0;i>r;++r){if(s=t[r],!_.isArray(s))throw new Error("Topology(): connectivity list must be an array.");if(a=s.length,a>0){if(p=s[0],!_.isArray(p))throw new Error("Topology(): cell index list must be an array.");for(u=p.length,o=0;a>o;++o){if(p=s[o],!_.isArray(p))throw new Error("Topology(): cell index list must be an array.");if(p.length!==u)throw new Error("Topology(): inconsist cell size.");for(n=0;u>n;++n)if(c=p[n],(0|c)!==c)throw new Error("Topology: cell index must be an integer.")}}}var l=_.cloneDeep(t);this._complexes=l;var f=[];if(_.isArray(e)&&e.length===this._complexes.length)this._cellSizes=_.clone(e);else if(this._cellSizes=this._complexes.map(function(t,e){return 0===t.length?(f.push("Topology(): Can not determine the dim of cells in dim "+e),-1):t[0].length}),f.length>0)throw new Error(f.join("\n"))}function hypercubeCellBoundary1(t){var e=[t[0]],r=[t[1]];return[e,r]}function hypercubeCellBoundary2(t){var e=[t[0],t[1]],r=[t[1],t[2]],o=[t[2],t[3]],n=[t[3],t[0]];return[e,r,o,n]}function hypercubeCellBoundary3(t){var e=t[0],r=t[1],o=t[2],n=t[3],i=t[4],s=t[5],a=t[6],u=t[7],p=[e,n,o,r],c=[e,r,s,i],l=[r,o,a,s],f=[o,n,u,a],h=[e,i,u,n],d=[i,s,a,u];return[p,c,l,f,h,d]}function hypercubeSkeleton(t,e){var r;if(1===e)r=hypercubeCellBoundary1;else if(2===e)r=hypercubeCellBoundary2;else{if(3!==e)throw new Error("hypercubeBoundaryCells(conn, dim): dim ("+e+") is not valid.");r=hypercubeCellBoundary3}var o=function(t){return normalizedCell(t).join(",")},n={},i=[];return t.forEach(function(t){var e=r(t);e.forEach(function(t){var e=o(t);n[e]||(i.push(t),n[e]=!0)})}),i}function hypercube0_(t){return"number"==typeof t[0]?[t.map(function(t){return[t]})]:[cloneDeep(t)]}function hypercube1_(t){var e=array1d(2,function(){return null});return e[1]=cloneDeep(t),e[0]=hypercubeSkeleton(e[1],1),e}function hypercube2_(t){var e=array1d(3,function(){return null});return e[2]=cloneDeep(t),e[1]=hypercubeSkeleton(e[2],2),e[0]=hypercubeSkeleton(e[1],1),e}function hypercube3_(t){var e=array1d(4,function(){return null});return e[3]=cloneDeep(t),e[2]=hypercubeSkeleton(e[3],3),e[1]=hypercubeSkeleton(e[2],2),e[0]=hypercubeSkeleton(e[1],1),e}function hypercube(t,e){if(0===e)return new Topology(hypercube0_(t));if(1===e)return new Topology(hypercube1_(t));if(2===e)return new Topology(hypercube2_(t));if(3===e)return new Topology(hypercube3_(t));throw new Error("hypercube(conn, dim): dim must be one of 0,1,2,3.")}function simplex(){var t=[];return new Topology(t)}function IntegrationRule(){}function GaussRule(t,e){var r,o;switch(e){case 1:r=[0],o=[2];break;case 2:r=[-.577350269189626,.577350269189626],o=[1,1];break;case 3:r=[-.774596669241483,0,.774596669241483],o=[.5555555555555556,.888888888888889,.5555555555555556];break;case 4:r=[-.86113631159405,-.33998104358486,.33998104358486,.86113631159405],o=[.34785484513745,.65214515486255,.65214515486255,.34785484513745];break;default:throw new Error("GaussRule(dim, order): for order = "+e+" is not implemented.")}var n,i,s,a,u;switch(t){case 1:n=transpose([r]),i=o;break;case 2:for(n=[],i=[],s=0;e>s;++s)for(a=0;e>a;++a)n.push([r[s],r[a]]),i.push(o[s]*o[a]);break;case 3:for(n=[],i=[],s=0;e>s;++s)for(a=0;e>a;++a)for(u=0;e>u;++u)n.push([r[s],r[a],r[u]]),i.push(o[s]*o[a]*o[u]);break;default:throw new Error("GaussRule(dim, order): for dim = "+t+" is not implemented.")}this._paramCoords=n,this._weights=i}function Material(){}function DeforSSLinElUniax(t){_input_contract_linel_uniax_prop_(t),this._prop=t.property}function DeforSSLinElBiax(t){_input_contract_linel_uniax_prop_(t),this._prop=t.property,this._reduction=t.reduction||"strain"}function Mesh(t,e){this.fens=t,this.gcells=e}function L2x2(){var t,e;return t=new FeNodeSet({xyz:[[.5,0],[1,0],[1,.5],[.5,.5],[1,1],[.5,1],[0,1],[0,.5]]}),e=new Q4({conn:[[1,2,3,4],[4,3,5,6],[4,6,7,8]]}),new Mesh(t,e)}function NodalLoad(t){var e=t.ids||t.id,r=t.dirs||t.dir,o=t.magns||t.magn;check.array(e)||(e=[e]),check.array(r)||(r=[r]),check.array(o)||(o=[o]),this._ids=e,this._dirs=r,this._magns=o}function MaterialProperty(t){this._rho=t&&"number"==typeof t.rho?t.rho:1}function LinElIso(t){_input_contract_LinElIsoProp_(t),MaterialProperty.call(this,t),this._E=t.E,this._nu=t.nu,check.assigned(this._nu)||(this._nu=0)}function mldivide(t,e){if(t instanceof SparseSystemMatrix&&e instanceof SparseSystemVector)return t.dokMatrix().solveSparseVector(e.sparseVector()).toList();if(t instanceof SparseSystemMatrix&&isVector(e))return t.dokMatrix().solveVector(e);throw new Error("system.solve(): unsupported type A and b.")}function ElementMatrix(t,e){this.matrix=t,this.eqnums=e}function assemble_(t,e){if(!isIterator(e)){if(!isArray(e))throw new Error("assemble_(dest, sources): sources must be a iterator or array.");e=iteratorFromList(e)}for(var r;e.hasNext();){r=e.next();var o=r.matrix,n=r.eqnums,i=n.map(function(t,e){return{globalIndex:t,localIndex:e}}).filter(function(t){return 0!==t.globalIndex});i.forEach(function(e){var r=e.globalIndex-1,n=e.localIndex;i.forEach(function(e){var i=e.globalIndex-1,s=e.localIndex,a=t.at(r,i),u=o[n][s];t.set_(r,i,a+u)})})}}function SparseSystemMatrix(t,e,r){this._kes=r,this._nrows=t,this._ncols=e,this._dokMatrix=null}function ElementVector(t,e){this.vector=t,this.eqnums=e}function SparseSystemVector(t,e){this._dim=t,this._evs=e,this._sparseVector=null}Bimap.prototype.insert=function(t,e){Array.isArray(t)&&(e=t[1],t=t[0]);var r=this.getKeyOf(t),o=this.getKeyOf(e);return this._l2r[r]=e,this._r2l[o]=t,this},Bimap.prototype.add=Bimap.prototype.insert,Bimap.prototype.size=function(){return Object.keys(this._l2r).length},Bimap.prototype.empty=function(){return 0===this.size()},Bimap.prototype.clear=function(){return this._l2r={},this._r2l={},this},Bimap.prototype.insertSafe=function(t,e){Array.isArray(t)&&(e=t[1],t=t[0]);var r=this.getKeyOf(t);if("undefined"!=typeof this._l2r[r])throw new Error(t+" with key"+r+" exists!");return this.add(t,e),this},Bimap.prototype.getKeyOf=function(t){return t&&t._uid?t._uid:t},Bimap.prototype.belongsTo=function(t){var e=this.getKeyOf(t);return"undefined"!=typeof this._l2r[e]?"left":"undefined"!=typeof this._r2l[e]?"right":"none"},Bimap.prototype.leftFind=function(t){return this._l2r[this.getKeyOf(t)]},Bimap.prototype.rightFind=function(t){return this._r2l[this.getKeyOf(t)]},Bimap.prototype.find=function(t){return this.leftFind(t)||this.rightFind(t)},Bimap.prototype.lookup=Bimap.prototype.find,Bimap.prototype.inLeft=function(t){return"undefined"!=typeof this.leftFind(t)},Bimap.prototype.inRight=function(t){return"undefined"!=typeof this.rightFind(t)},Bimap.prototype.containsObject=function(t){return"undefined"!=typeof this.find(t)},Bimap.prototype.containsPair=function(t,e){Array.isArray(t)&&(e=t[1],t=t[0]);var r=this.leftFind(t);return"undefined"!=typeof r?this.getKeyOf(e)===this.getKeyOf(r):!1},Bimap.prototype.contains=function(){var t=Array.prototype.slice.call(arguments),e=t.length;return 1>=e?this.containsObject(t[0]):this.containsPair(t[0],t[1])},Bimap.prototype.leftRemove=function(t){var e=this.leftFind(t);return"undefined"!=typeof e&&(delete this._l2r[this.getKeyOf(t)],this.rightRemove(e)),this},Bimap.prototype.rightRemove=function(t){var e=this.rightFind(t);return"undefined"!=typeof e&&(delete this._r2l[this.getKeyOf(t)],this.leftRemove(e)),this},Bimap.prototype.removePair=function(t,e){return this.containsPair(t,e)&&(delete this._l2r[this.getKeyOf(t)],delete this._r2l[this.getKeyOf(e)]),this},Bimap.prototype.remove=function(){var t=Array.prototype.slice.call(arguments),e=t.length;if(1>=e){var r=t[0];this.inLeft(r)?this.leftRemove(r):this.inRight(r)&&this.rightRemove(r)}else this.removePair(t[0],t[1]);return this},Bimap.prototype.erase=Bimap.prototype.remove,Bimap.prototype.getNodes=function(t){if(!t)return this.getLeftNodes().concat(this.getRightNodes());var e=/[lL](eft)?/.test(t)?this._r2l:this._l2r;return Object.keys(e).map(function(t){return e[t]})},Bimap.prototype.getLeftNodes=function(){return this.getNodes("left")},Bimap.prototype.getRightNodes=function(){return this.getNodes("right")},Bimap.prototype.forEachNode=function(t,e,r){var o=this.getNodes(t);o.forEach(e,r||this)},Bimap.prototype.forEachLeftNode=function(t,e){this.forEachNode("left",t,e)},Bimap.prototype.forEachRightNode=function(t,e){this.forEachNode("right",t,e)},Bimap.prototype.toJSON=function(){var t={};return this.forEachLeftNode(function(e){var r=this.find(e);t[e]=r},this),t},exports.Bimap=Bimap,Bipartite.prototype.getNumOfLeftNodes=function(){return Object.keys(this._l2r).length},Bipartite.prototype.getNumOfRightNodes=function(){return Object.keys(this._r2l).length},Bipartite.prototype.getNumOfNodes=function(){return this.getNumOfLeftNodes()+this.getNumOfRightNodes()},Bipartite.prototype.getNumOfEdges=function(){var t=0;return this.forEachLeftNode(function(e){t+=this.getDegree(e)},this),t},Bipartite.prototype.empty=function(){return 0===this.getNumOfNodes()},Bipartite.prototype.clear=function(){return this._l2r={},this._r2l={},this},Bipartite.prototype.getKeyOf=function(t){return t&&t._uid?t._uid:t},Bipartite.prototype.addNode=function(t,e){var r=this.getKeyOf(e),o=/[lL](eft)?/.test(t)?this._l2r:this._r2l;return o[r]={node:e,neighbors:{}},this},Bipartite.prototype.addLeftNode=function(t){return this.addNode("l",t)},Bipartite.prototype.addRightNode=function(t){return this.addNode("r",t)},Bipartite.prototype.addEdges=function(t){return t.forEach(function(t){var e=t[0],r=t[1];this.addEdge(e,r)},this),this},Bipartite.prototype.addEdge=function(t,e){Array.isArray(t)&&(e=t[1],t=t[0]);var r=this.getKeyOf(t),o=this.getKeyOf(e);return this._l2r[r]||(this._l2r[r]={node:t,neighbors:{}}),this._r2l[o]||(this._r2l[o]={node:e,neighbors:{}}),this._l2r[r].neighbors[o]=e,this._r2l[o].neighbors[r]=t,this},Bipartite.prototype.insert=Bipartite.prototype.addEdge,Bipartite.prototype.removeEdge=function(t,e){if(Array.isArray(t)&&(e=t[1],t=t[0]),this.hasPair(t,e)){var r=this.getKeyOf(t),o=this.getKeyOf(e);delete this._l2r[r].neighbors[o],delete this._r2l[o].neighbors[r],this._autoRemoveIsolatedNodes===!0&&(0===Object.keys(this._l2r[r].neighbors).length&&delete this._l2r[r],0===Object.keys(this._r2l[o].neighbors).length&&delete this._r2l[o])}return this},Bipartite.prototype.erase=Bipartite.prototype.removeEdge,Bipartite.prototype.removeNode=function(t){var e=this.belongsTo(t);return"none"===e?this:(this.getNeighbors(t).forEach(function(r){var o,n;"left"===e?(o=t,n=r):(o=r,n=t),this.removeEdge(o,n)},this),this)},Bipartite.prototype.eraseNode=Bipartite.prototype.removeNode,Bipartite.prototype.hasNode=function(t){var e=this.getKeyOf(t);return this._l2r[e]?!0:this._r2l[e]?!0:!1},Bipartite.prototype.hasEdge=function(t,e){var r=this.getKeyOf(t),o=this.getKeyOf(e);if(this._l2r[r]){var n="undefined"!=typeof this._l2r[r].neighbors[o],i="undefined"!=typeof this._r2l[o].neighbors[r];return console.assert(n===i),n}return!1},Bipartite.prototype.contains=function(){var t=Array.prototype.slice.call(arguments),e=t.length;return 1>=e?this.hasNode(t[0]):(this.hasEdge(t[0]),t[1])},Bipartite.prototype.isAdjacent=function(t,e){return this.hasEdge(t,e)||this.hasEdge(e,t)},Bipartite.prototype.hasPair=Bipartite.prototype.isAdjacent,Bipartite.prototype.getNeighbors=function(t){var e=this.getKeyOf(t),r=null;return this._l2r[e]&&(r=this._l2r[e].neighbors),this._r2l[e]&&(r=this._r2l[e].neighbors),null===r?[]:Object.keys(r).map(function(t){return r[t]})},Bipartite.prototype.getDegree=function(t){var e=this.getKeyOf(t);return this._l2r[e]?Object.keys(this._l2r[e].neighbors).length:this._r2l[e]?Object.keys(this._r2l[e].neighbors).length:-1},Bipartite.prototype.getGroupName=function(t){var e=this.getKeyOf(t);return this._l2r[e]?"left":this._r2l[e]?"right":"none"},Bipartite.prototype.belongsTo=Bipartite.prototype.getGroupName,Bipartite.prototype.getNodesOfGroup=function(t,e){var r,o=/[lL](eft)?/.test(t)?this._l2r:this._r2l;return r=Object.keys(o).map(function(t){return o[t].node}),"function"==typeof e&&(r=r.filter(e)),r},Bipartite.prototype.getLeftNodes=function(t){return this.getNodesOfGroup("left",t)},Bipartite.prototype.getRightNodes=function(t){return this.getNodesOfGroup("right",t)},Bipartite.prototype.getNodes=function(t){return this.getLeftNodes(t).concat(this.getRightNodes(t))},Bipartite.prototype.forEachLeftNode=function(t,e){this.getLeftNodes().forEach(t,e||this)},Bipartite.prototype.forEachRightNode=function(t,e){this.getRightNodes().forEach(t,e||this)},Bipartite.prototype.forEachNode=function(t,e){this.forEachLeftNode(t,e),this.forEachRightNode(t,e)},Bipartite.prototype.forEachEdge=function(t,e){var r=e||this;this.forEachLeftNode(function(e){this.getNeighbors(e).forEach(function(o){t.call(r,e,o)})},this)},Bipartite.prototype.toDot=function(){var t=["graph g {"];return this.forEachLeftNode(function(e){this.getNeighbors(e).forEach(function(r){var o=this.getKeyOf(e),n=this.getKeyOf(r);t.push("  "+o+" -- "+n)},this)},this),t.push("}"),t.join("\n")},exports.Bipartite=Bipartite;var _=require("./core.utils"),cloneDeep=_.cloneDeep,array1d=_.array1d,array2d=_.array2d,listFromIterator=_.listFromIterator,numeric=require("numeric"),ccsSparse=numeric.ccsSparse,ccsFull=numeric.ccsFull,ccsLUP=numeric.ccsLUP,ccsLUPSolve=numeric.ccsLUPSolve;exports.norm=norm,exports.nthRow=nthRow,exports.nthColumn=nthColumn,exports.ix=ix,exports.ixUpdate=ixUpdate,exports.colon=colon,exports.size=size,vecEquals.TOLERANCE=1e-4,exports.vecEquals=vecEquals,exports.array1dEquals=vecEquals,array2dEquals.TOLERANCE=1e-4,exports.array2dEquals=array2dEquals,exports.matrixEquals=array2dEquals,exports.ccsValueListIterator=ccsValueListIterator,exports.isMatrixLikeArray=isMatrixLikeArray,DenseMatrix.prototype.at=function(t,e){if(t>=0&&t<this._m&&e>=0&&e<this._n)return this._data[t][e];throw new Error("DenseMatrix::at(): index "+[t,e]+" outof bound "+[this.m,this.n])},DenseMatrix.prototype.size=function(){return[this._m,this._n]},DenseMatrix.prototype.m=function(){return this._m},DenseMatrix.prototype.n=function(){return this._n},DenseMatrix.prototype.set_=function(t,e,r){if(0>t||t>=this._m||0>e||e>=this._n)throw new Error("DenseMatrix::set(): index "+[t,e]+" outof bound "+[this.m,this.n]);if("number"!=typeof r)throw new Error("DenseMatrix::set_(i, j, val): val must be a number.");this._data[t][e]=r},DenseMatrix.prototype.toFull=function(){return _.cloneDeep(this._data)},DenseMatrix.prototype.toCcs=function(){return ccsSparse(this._data)},exports.DenseMatrix=DenseMatrix,exports.ensureMatrixDimension=ensureMatrixDimension,DokSparseMatrix.prototype.size=function(){return[this.m,this.n]},DokSparseMatrix.prototype.m=function(){return this._m},DokSparseMatrix.prototype.n=function(){return this._n},DokSparseMatrix.prototype.at=function(t,e){if(t>=0&&t<this._m&&e>=0&&e<this._n)return this._dict[e]&&this._dict[e][t]?this._dict[e][t]:0;throw new Error("DokSparseMatrix::at(i, j): i,j: "+[t,e]+" outof dimension m, n: "+[this._m,this._n])},DokSparseMatrix.prototype.set_=function(t,e,r){if(t>=0&&t<this._m&&e>=0&&e<this._n){if("number"!=typeof r)throw new Error("DokSparseMatrix::set_(i, j, val): val must be a number. val = "+r);return this._dict[e]||(this._dict[e]={}),void(this._dict[e][t]=r)}throw new Error("DokSparseMatrix::set_(i, j, val): i,j: "+[t,e]+" outof dimension m, n: "+[this._m,this._n])},DokSparseMatrix.prototype.toFull=function(){var t=this._m,e=this._n,r=array2d(t,e,0);return Object.keys(this._dict).forEach(function(t){Object.keys(this._dict[t]).forEach(function(e){r[e][t]=this.at(e,t)},this)},this),r},DokSparseMatrix.prototype.toCcs=function(){var t=this._dict,e=(this._m,this._n),r=[[0],[],[]],o=array1d(e,function(e){return"undefined"!=typeof t[e]?Object.keys(t[e]).length:0});o.forEach(function(t){var e=r[0],o=e[e.length-1];e.push(o+t)});var n=Object.keys(t).sort(function(t,e){return parseInt(t)-parseInt(e)});return n.forEach(function(e){Object.keys(t[e]).forEach(function(o){var n=t[e][o];r[1].push(o),r[2].push(n)})}),r},DokSparseMatrix.prototype.toJSON=function(){return{m:this.m,n:this.n,values:this.toValueList()}},DokSparseMatrix.prototype.toValueList=function(){var t=[],e=this._dict;return Object.keys(e).forEach(function(r){Object.keys(e[r]).forEach(function(o){var n=e[r][o];t.push([r,o,n])})}),t},DokSparseMatrix.prototype.solveVector=function(t){if(this._m!==this._n)throw new Error("DokSparseMatrix::solve can only be used by square matrix where this.m === this.n.");if(this._m!==t.length)throw new Error("DokSparseMatrix::solve can only be applied to vector of same dimension.");var e=this.toCcs(),r=ccsLUP(e);return ccsLUPSolve(r,t)},DokSparseMatrix.prototype.solveSparseVector=function(t){if(!(t instanceof SparseVector))throw new Error("DokSparseMatrix::solveSparseVector(b): b must be a SparseVector.");if(this._m!==t.length())throw new Error("DokSparseMatrix::solve can only be applied to vector of same dimension.");var e=this.toCcs(),r=ccsLUP(e),o=t.toCcs(),n=ccsLUPSolve(r,o),i=listFromIterator(ccsValueListIterator(n)).map(function(t){return[t[0],t[2]]}),s=new SparseVector(i,this._m);return s},exports.DokSparseMatrix=DokSparseMatrix,SparseVector.prototype.length=function(){return this._dim
},SparseVector.prototype.dim=SparseVector.prototype.length,SparseVector.prototype.nzCount=function(){var t,e=0;for(t in this._dict)++e;return e},SparseVector.prototype.at=function(t){if(t>=0&&t<this._dim){var e=this._dict[t];return"number"==typeof e?e:0}throw new Error("SparseVector::at(i): index outof bound.")},SparseVector.prototype.valueListIterator=function(){var t=0,e=Object.keys(this._dict),r=e.length,o=this._dict;return e.sort(function(t,e){return parseInt(t)-parseInt(e)}),{hasNext:function(){return r>t},next:function(){var r=e[t],n=[parseInt(r),o[r]];return++t,n}}},SparseVector.prototype.equals=function(t,e){var r=this.toList(),o="function"==typeof t.toList?t.toList():t,n=vecEquals(r,o,e);return n},SparseVector.prototype.set_=function(t,e){if(0>t||t>=this._dim)throw new Error("SparseVector::set_(i): index outof bound.");if("number"!=typeof e)throw new Error("SparseVector::set_(i, val): val must be a number. val = "+e);0!==e&&(this._dict[t]=e)},SparseVector.prototype.toCcs=function(){var t,e,r=this._dict,o=(this._dim,[[0,-1],[],[]]),n=0;for(t in r)e=parseInt(t),o[1].push(e),o[2].push(r[e]),++n;return o[0][1]=n,o},SparseVector.prototype.toFull=function(){var t=this._dim,e=this._dict;return array2d(t,1,function(t){return"number"==typeof e[t]?e[t]:0})},SparseVector.prototype.toList=function(){var t=this._dim,e=this._dict;return array1d(t,function(t){return"number"==typeof e[t]?e[t]:0})},exports.mldivide=mldivide,exports.eye=eye,exports.SparseVector=SparseVector,_.assign(exports,numeric);var Bimap=require("./core.bimap").Bimap;SetStore.prototype.size=function(){return Object.keys(this._items).length},SetStore.prototype.empty=function(){return 0===this.size()},SetStore.prototype.clear=function(){this._items={},this._byTypes={},this._byLabels.clear()},SetStore.prototype.contains=function(t){return"undefined"!=typeof this.find(t)},SetStore.prototype.has=SetStore.prototype.contains,SetStore.prototype.insert=function(t){var e=this.getKeyOf(t),r=this.getTypeOf(t);return"undefined"!=typeof this._items[e]?!1:(this._items[e]=t,r&&("undefined"==typeof this._byTypes[r]&&(this._byTypes[r]={}),this._byTypes[r][e]=t),!0)},SetStore.prototype.add=SetStore.prototype.insert,SetStore.prototype.erase=function(t){var e=this.getKeyOf(t),r=this.getTypeOf(t);return"undefined"==typeof this._items[e]?!1:(delete this._items[e],r&&(delete this._byTypes[r][e],0===Object.keys(this._byTypes[r]).length&&delete this._byTypes[r]),!0)},SetStore.prototype.remove=SetStore.prototype.erase,SetStore.prototype.find=function(t){var e=this.getKeyOf(t);return this._items[e]},SetStore.prototype.get=SetStore.prototype.find,SetStore.prototype.findInType=function(t,e){var r=this.getKeyOf(t),o=this._byTypes[e];return o?o[r]:void 0},SetStore.prototype.getAllTypes=function(){return Object.keys(this._byTypes)},SetStore.prototype.getTypeOf=function(t){return t&&"function"==typeof t.getType?t.getType():""},SetStore.prototype.forEach=function(t,e){var r,o=this._items,n=e||this;for(r in o)t.call(n,o[r],r)},SetStore.prototype.getKeyOf=function(t){return t&&t._uid?t._uid:t},SetStore.prototype.setKeyOf=function(t,e){this.contains(t)&&(this.erase(t),item._uid=e,this.insert(t))},SetStore.prototype.setLabelOf=function(t,e){this.contains(t)&&("string"==typeof e&&e?this._byLabels.insert(e,t):this._byLabels.remove(t))},SetStore.prototype.unsetLabelOf=function(t){this.setLabelOf(t,"")},SetStore.prototype.getLabelOf=function(t){return this._byLabels.lookup(t)||""},SetStore.prototype.findByLabel=function(t){return this._byLabels.lookup(t)},SetStore.prototype.isLabeled=function(t){return""!==this.getLabelOf(t)},SetStore.prototype.labelExists=function(t){return void 0!==this.findByLabel(t)},SetStore.prototype.getAllLabels=function(){return this._byLabels.getLeftNodes()},SetStore.prototype.getItemsOfType=function(t,e){var r=this._byTypes[t];return r=Object.keys(r).map(function(t){return r[t]}),"function"==typeof e&&(r=r.filter(e)),r},SetStore.prototype.getItems=function(t){var e=this._items;return e=Object.keys(e).map(function(t){return e[t]}),"function"==typeof t&&(e=e.filter(t)),e},exports.SetStore=SetStore;var _=require("lodash"),numeric=require("numeric"),conflicts=["all","any","clone","identity","isFinite","isNaN","max","min","random"];_(numeric).keys().difference(conflicts).forEach(function(t){_[t]=numeric[t]}),_.numeric=numeric,_.Bimap=require("./core.bimap").Bimap,_.Bipartite=require("./core.bipartite").Bipartite,_.SetStore=require("./core.setstore").SetStore,_.array1d=array1d,_.array2d=array2d,_.embed=embed,_.byLexical=byLexical,_.rotateLeft=rotateLeft,_.rotateRight=rotateRight,_.minIndex=minIndex,_.isIterator=isIterator,_.noopIterator={hasNext:function(){return!1},next:function(){return null}},_.listFromIterator=listFromIterator,_.iteratorFromList=iteratorFromList,_.uuid=uuid,_.normalizedCell=normalizedCell;var check=require("check-types"),assert=require("assert");_._env="dev",_.noop=noop,assert.string=check.assert.string,assert.unemptyString=check.assert.unemptyString,assert.webUrl=check.assert.webUrl,assert.length=check.assert.length,assert.number=check.assert.number,assert.positive=check.assert.positive,assert.negative=check.assert.negative,assert.odd=check.assert.odd,assert.even=check.assert.even,assert.integer=check.assert.integer,assert["function"]=check.assert["function"],assert.array=check.assert.array,assert.length=check.assert.length,assert.date=check.assert.date,assert.object=check.assert.object,assert.emptyObject=check.assert.emptyObject,assert.instance=check.assert.instance,assert.like=check.assert.like,assert["null"]=check.assert["null"],assert.undefined=check.assert.undefined,assert.assigned=check.assert.assigned,assert["boolean"]=check.assert["boolean"],_.check=check,_.assert=assert,_.defineContract=defineContract,_.contracts={},_.contracts.matrixOfDimension=matrixOfDimension,_.isMatrixOfDimension=isMatrixOfDimension,_.contracts.vectorOfDimension=vectorOfDimension,_.isVectorOfDimension=isVectorOfDimension,module.exports=exports=_;var _=require("./core.utils"),check=_.check,isArray=_.isArray,isIterator=_.isIterator,iteratorFromList=_.iteratorFromList;exports.EBC=EBC,EBC.prototype.applyToField_=function(t){for(var e,r=this._idIterFn(t),o=this._valFn,n=this._dirs,i=0;r.hasNext();)e=r.next(),n.forEach(function(r){var n=o(e,r,i,t);t.setPrescribedValue_(e,r,n)}),++i},exports.EBC;var _=require("./core.utils"),assert=_.assert,check=_.check,array2d=_.array2d,array1d=_.array1d,defineContract=_.defineContract,isMatrixOfDimension=_.isMatrixOfDimension,numeric=require("./core.numeric"),size=numeric.size,transpose=numeric.transpose,dot=numeric.dot,add=numeric.add,mul=numeric.mul,inv=numeric.inv,norm=numeric.norm,ixUpdate=numeric.ixUpdate,colon=numeric.colon,Material=require("./material").Material,GCellSet=require("./gcellset").GCellSet,IntegrationRule=require("./integrationrule").IntegrationRule,ElementMatrix=require("./system.matrix").ElementMatrix,ElementVector=require("./system.vector").ElementVector,_input_contract_deforss_option=defineContract(function(t){if(assert.object(t),!check.instance(t.material,Material))throw new Error("options.material is not a instance of Material");if(!check.instance(t.gcells,GCellSet))throw new Error("options.gcells is not a instance of GCellSet");if(!check.instance(t.integrationRule,IntegrationRule))throw new Error("options.integrationRule is not a instance of integrationRule")},"Input is not valid DeforSS option.");DeforSS.prototype=Object.create(Feblock.prototype),DeforSS.prototype.constructor=DeforSS,DeforSS.prototype._blmat1=function(t,e,r,o){var n,i,s,a,u,p,c=size(e,1),l=size(r,2),f=array2d(1,c*l,0);if(!o)throw new Error("_blmat1: not implmented when !Rm");for(s=o.map(function(t){return t[0]}),n=1;c>=n;++n)a=l*(n-1),u=l*n-1,p=u-a,i=array1d(p+1,function(t){return a+t}),i.forEach(function(t,r){f[0][t]=e[n-1][0]*s[r]});return f},DeforSS.prototype._blmat2=function(t,e,r,o){var n,i,s,a=size(e,1),u=size(r,2),p=array2d(3,a*u,0);if(!o)throw new Error("_blmat1: not implmented when !Rm");for(n=1;a>=n;++n)i=colon(u*(n-1)+1,u*n),s=[[e[n-1][0],0],[0,e[n-1][1]],[e[n-1][1],e[n-1][0]]],p=ixUpdate(p,":",i,s);return p},DeforSS.prototype.stiffness=function(t,e){var r,o=this._gcells,n=o.cellSize(),i=this._ir,s=i.paramCoords(),a=i.weights(),u=i.npts(),p=[],c=[];for(r=0;u>r;++r)p[r]=o.bfun(s[r]),c[r]=o.bfundpar(s[r]);var l=null;"function"==typeof this._rm&&(l=this._rm);var f,h=this._rm,d=this._mater,y=o.conn(),m=o.count(),_=new Array(m),g=new Array(m),S=t.dim();for(f=0;m>f;++f)g[f]=e.gatherEqnumsVector(y[f]),_[f]=array2d(S*n,S*n,0);var v,x,b,E,F,w,N,O,P,C=array1d(t.nfens(),function(t){return t+1}),L=t.gatherValuesMatrix(C);for(f=0;m>f;++f)for(v=y[f],x=v.map(function(t){return L[t-1]}),r=0;u>r;++r){if(b=dot(transpose(p[r]),x),E=dot(transpose(x),c[r]),l&&(h=l(b,E)),F=h?dot(c[r],inv(dot(transpose(h),E))):dot(c[r],inv(E)),w=o.jacobianVolumn(v,p[r],E,x),0>w)throw new Error("Non-positive Jacobian");N=this.hBlmat(p[r],F,b,h),O=d.tangentModuli({xyz:b}),P=dot(dot(transpose(N),mul(O,w*a[r])),N),_[f]=add(_[f],P)}var D=_.map(function(t,e){return new ElementMatrix(t,g[e])});return D},DeforSS.prototype.noneZeroEBCLoads=function(t,e){var r,o,n,i,s,a,u,p,c=this._gcells,l=c.count(),f=c.conn(),h=[];for(r=0;l>r;++r)o=f[r],n=e.gatherPrescirbedValues(o),0!==norm(n)&&(i=new DeforSS({material:this._mater,gcells:this._gcells.subset([r]),integrationRule:this._ir,rm:this._rm}),s=i.stiffness(t,e),a=s[0].matrix,u=mul(-1,dot(a,n)),p=e.gatherEqnumsVector(o),h.push(new ElementVector(u,p)));return h},exports.DeforSS=DeforSS;var Bipartite=require("./core.bipartite.js").Bipartite,Bimap=require("./core.bimap.js").Bimap,SetStore=require("./core.setstore.js").SetStore;FeObject.prototype.generateUid=uuid,FeObject.prototype.uid=function(){return this._uid},FeObject.prototype.getId=function(){return this._model?this._model.getIdOf(this):this._uid},FeObject.prototype.setId=function(t){return this._model&&this._model.setIdOf(this,t),this},FeObject.prototype.getLabel=function(){return this._model?this._model.getLabelOf(this):""},FeObject.prototype.setLabel=function(t){return this._model&&this._model.setLabelOf(this,t),this},FeObject.prototype.getType=function(){throw new NotImplementedError},FeObject.prototype.clone=function(){throw new NotImplementedError},FeObject.prototype.copy=function(){throw new NotImplementedError},FeObject.prototype.toJSON=function(){throw new NotImplementedError},FeObject.prototype.setFromJSON=function(){throw new NotImplementedError},FeNode.prototype=Object.create(FeObject.prototype),FeNode.prototype.constructor=FeNode,FeNode.prototype.getType=function(){return"fe_node"},FeNode.prototype.clone=function(){return new FeNode(this.x,this.y,this.z,this._model)},FeNode.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},FeNode.prototype.toJSON=function(){var t={};return t.x=this.x,t.y=this.y,t.z=this.z,t},FeNode.prototype.setFromJSON=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},FeNode.prototype.getElements=function(){var t=this._model,e=t._nodeEleGraph.getNeighbors(this);return Array.isArray(e)?e:[]},FeNode.prototype.isInElement=function(t){var e=this._model._nodeEleGraph;return e.hasEdge(this,t)},FeNode.prototype.isAdjacentTo=function(t){var e=this.getAdjacentNodes();return-1!==e.indexOf(t)},FeNode.prototype.getAdjacentNodes=function(){var t=this.getElements(),e=[],r={};return r[this.uid()]=!0,t.forEach(function(t){var o=t.getNodes();o.forEach(function(t){var o=t.uid();r[o]||(e.push(t),r[o]=!0)})}),e},FeNode.prototype.setConstraint=function(){},FeNode.prototype.getNumOfConstraints=function(){},FeNode.prototype.isFree=function(){},FeNode.prototype.isConstrained=function(){},FeNode.prototype.setFixedIn=function(){},FeNode.prototype.setFreeIn=function(){},FeNode.prototype.isFreeIn=function(){},FeNode.prototype.isFixedIn=function(){},FeNode.prototype.isFixedIn=function(){},FeNodeProperty.prototype=Object.create(FeObject.prototype),FeNodeProperty.prototype.constructor=FeNodeProperty,FeNodeProperty.prototype.getType=function(){return"fe_node_property"},FeNodeProperty.prototype.clone=function(){var t=new FeNodeProperty(this._model);return t.copy(this),this},FeNodeProperty.prototype.copy=function(t){return this._model=t._model,this.setNodes(t.getNodes()),this._values={},this._valuse.spc=new FeSPC,this._values.spc.copy(t._values.spc),this._valuse.forceLoad=new FeNodalLoad,this._values.forceLoad.copy(t._values.forceLoad),this._valuse.dispLoad=new FeNodalLoad,this._values.dispLoad.copy(t._values.dispLoad),this},FeNodeProperty.prototype.toJSON=function(){var t={};return t.nodes=this.getNodes().map(getId),t.values=this.getValues(),t},FeNodeProperty.prototype.getNodes=function(){var t=this._model._nodePropGraph,e=t.getNeighbors(this);return Array.isArray(e)?e:[]},FeNodeProperty.prototype.getNumOfNodes=function(){return this.getNodes().length},FeNodeProperty.prototype.setNodes=function(t){return this._model.assignNodeProperty(t,this),this},FeNodeProperty.prototype.getValues=function(){var t={};return this._values.spc.isConstrained()&&(t.spc=this._values.spc.getValue()),this._values.forceLoad.isZero()||(t.forceLoad=this._values.forceLoad.getValue()),this._values.dispLoad.isZero()||(t.dispLoad=this._values.dispLoad.getValue()),t};var spcMethods=["setConstraint","getNumOfConstraints","isFree","isConstrained","setFixedIn","setFreeIn","isFreeIn","isFixedIn"];spcMethods.forEach(function(t){FeNodeProperty.prototype[t]=function(){var e=this._values.spc[t].apply(this._values.spc,arguments);return e===this._values.spc&&(e=this),e}}),FeSPC.prototype=Object.create(FeNodeProperty.prototype),FeSPC.prototype.constructor=FeSPC,FeSPC.prototype.getType=function(){return"spc"},FeSPC.prototype.copy=function(t){return this._comps=clone(t._comps),this},FeSPC.prototype.clone=function(){var t=new FeSPC;return t._comps=clone(this._comps),t},FeSPC.prototype.toJSON=function(){var t={};return t.components=clone(this._comps),t},FeSPC.prototype.getValue=function(){return clone(this._comps)},FeSPC.prototype.setValue=function(t){return this._comps=clone(t),this},FeSPC.prototype.setConstraint=function(t,e){if(Array.isArray(t))t.forEach(function(t,r){var o=Array.isArray(e)?e[r]:e;this.setConstraint(t,o)},this);else{for(var r=this._comps.length;t>r;++r)this._comps[r]=null;this._comps[t]=e}return this},FeSPC.prototype.getNumOfConstraints=function(){var t=0;return this._comps.forEach(function(e){null!==e&&++t}),t},FeSPC.prototype.isFree=function(){return 0===this.getNumOfConstraints()},FeSPC.prototype.isConstrained=function(){return!this.isFree()},FeSPC.prototype.setFixedIn=function(t){Array.isArray(t)||(t=[t]);var e=t.map(function(){return 0});return this.setConstraint(t,e),this},FeSPC.prototype.setFreeIn=function(t){Array.isArray(t)||(t=[t]);var e=t.map(function(){return null});return this.setConstraint(t,e),this},FeSPC.prototype.isFreeIn=function(t){var e=this._comps[t];return null===e||"undefined"==typeof e},FeSPC.prototype.isFixedIn=function(t){return!this.isFree(t)},FeNodalLoad.prototype=Object.create(FeNodeProperty.prototype),FeNodalLoad.prototype.constructor=FeNodalLoad,FeNodalLoad.prototype.getType=function(){return this._type},FeNodalLoad.prototype._setType=function(t){return this._type=/^(nodal_)?[dD]isp(lacement)?(_load)?$/.test(t)?"nodal_displacement_load":"nodal_force_load",this},FeNodalLoad.prototype.getValues=function(){return this._values.slice()},FeNodalLoad.prototype._setValues=function(t){return this._values=t.slice(),this},FeNodalLoad.prototype.isZero=function(){return 0===this._values.reduce(function(t,e){return t+e*e},0)},FeNodalLoad.prototype.getValueAt=function(t){return"undefined"==typeof t?this.getValues():(Array.isArray(t)||(t=[t]),t.map(function(t){var e=this._values[t];return"number"!=typeof e||isNaN(e)?0:e},this))},FeNodalLoad.prototype.setValueAt=function(t,e){if(Array.isArray(t))t.forEach(function(t,r){var o=Array.isArray(e)?e[r]:e;this.setLoad(t,o)},this);else{for(var r=this._values.length;t>r;++r)this._values[r]=0;this._values[t]=e}return this},FeElement.prototype=Object.create(FeObject.prototype),FeElement.prototype.constructor=FeElement,FeElement.prototype.getType=function(){return"fe_element"},FeElement.prototype.toJSON=function(){var t={};return t.id=this.uid(),t.nodes=this._nodes.map(function(t){return t.uid()}),t},FeElement.prototype.getNodes=function(){return this._nodes.slice()},FeElement.prototype.getNumOfNodes=function(){return this._nodes.length},FeElement.prototype.hasNode=function(t){return-1!==this._nodes.indexOf(t)},FeElement.prototype.isAdjacentTo=function(t){var e=this.getAdjacentElements();return-1!==e.indexOf(t)},FeElement.prototype.getAdjacentElements=function(){var t=[],e={};e[this.uid()]=!0;var r=this._nodes;return r.forEach(function(r){var o=r.getElements();o.forEach(function(r){var o=r.uid();e[o]||(t.push(r),e[o]=!0)})}),t},FeElementProperty.prototype=Object.create(FeObject.prototype),FeElementProperty.prototype.constructor=FeElementProperty,FeElementProperty.prototype.getType=function(){return""},FeElementProperty.prototype.getElements=function(){var t=this._model._elePropGraph,e=t.getNeighbors(this);return Array.isArray(e)?e:[]},FeElementProperty.prototype.setElements=function(t){var e=(this.uid(),this._model._elePropGraph);return Array.isArray(t)||(t=[t]),t.forEach(function(t){e.addEdge(t,this)},this),this},FeElementProperty.prototype.getValue=function(){return null},FeElementProperty.prototype.setValue=function(){return this},TrussElementProperty.prototype=Object.create(FeElementProperty.prototype),TrussElementProperty.prototype.constructor=TrussElementProperty,TrussElementProperty.prototype.getType=function(){return"truss"},TrussElementProperty.prototype.copy=function(t){return this._model=t._model,this.A=t.A,this.E=t.E,this},TrussElementProperty.prototype.clone=function(){return new TrussElementProperty(this._model,this.A,this.E)},FeTimeSeries.prototype=Object.create(FeObject.prototype),FeTimeSeries.prototype.constructor=FeTimeSeries,FeTimeSeries.prototype.getType=function(){return this._type},FeTimeSeries.prototype.setType=function(t){if(/^[lL]inear$/.test(t))this._type="linear";else{if(!/^[cC]onstant$/.test(t))throw new Error("Unknown time series type"+t+"!");this._type="constant"}return this},FeTimeSeries.prototype.getFactor=function(){return this._factor},FeTimeSeries.prototype.setFactor=function(t){return t=parseFloat(t),this._factor=isNaN(t)?1:t,this},FeTimeSeries.prototype.getParams=function(){return clone(this._params)},FeTimeSeries.prototype.setParams=function(t){return this._params=clone(t),this},FeTimeSeries.prototype.evalAt=function(t){var e=this._type,r=(this._params,this._factor);switch(e){case"linear":return r*t;case"constant":default:return r}},FeTimeSeries.prototype.toJSON=function(){var t={};return t.id=this.uid(),t.type=this.getType(),t.factor=this.getFactor(),t.params=this.getParams(),t},FePattern.prototype=Object.create(FeObject.prototype),FePattern.prototype.constructor=FePattern,FePattern.prototype.getType=function(){return""},FePattern.prototype.getTimeSeries=function(){return this._ts},FePattern.prototype.setTimeSeries=function(t){return this._ts=t,this},FePattern.prototype.getFactor=function(){return this._ts.getFactor()},FePattern.prototype.setFactor=function(t){return this._ts.setFactor(t),this},FePattern.prototype.setAsCurrent=function(){return this._model.setCurrentPattern(this),this},FePlainPattern.prototype=Object.create(FePattern.prototype),FePlainPattern.prototype.constructor=FePlainPattern,FePlainPattern.prototype.getType=function(){return"plain"},FePlainPattern.prototype.createNodalLoad=function(t,e){var r=new FeNodalLoad;return r._setType(e),r._setValues(t),this._nodalLoads[r.uid()]=r,r},FePlainPattern.prototype.createNodalLoad=function(t,e){var r=new FeNodalLoad;return r._setType(e),r._setValues(t),this._nodalLoads[r.uid()]=r,r},FePlainPattern.prototype.createBeamUniformLoad=function(){return null},FePlainPattern.prototype.createBeamPointLoad=function(){return null},FePlainPattern.prototype.assignNodalLoad=function(t,e){var r=this._nodalLoadGraph;return Array.isArray(t)||(t=[t]),t.forEach(function(t){r.addEdge(t,e)}),this},FePlainPattern.prototype.getNodalLoad=function(t){var e,r=this._nodalLoadGraph,o={};return e=r.hasNode(t)?r.getNeighbors()[0]:new FeNodalLoad,o.type=e.getType(),o.values=e.getValues(),o},FePlainPattern.prototype.toJSON=function(){var t={};return t.id=this.uid(),t.type=this.getType(),t.nodalLoads=Object.keys(this._nodeProps).map(function(t){return this[t].toJSON()},this._nodeProps),t.eleProps=Object.keys(this._eleProps).map(function(t){return this[t].toJSON()},this._eleProps),t},FeModel.prototype=Object.create(FeObject.prototype),FeModel.prototype.constructor=FeModel,FeModel.prototype.find=function(t){return this._objects.find(t)},FeModel.prototype.getObject=FeModel.prototype.find,FeModel.prototype.findInType=function(t,e){return this._objects.findInType(t,e)},FeModel.prototype.findNode=function(t){return this.findInType(t,"fe_node")},FeModel.prototype.findElement=function(t){return this.findInType(t,"fe_element")},FeModel.prototype.setIdOf=function(t,e){this._objects.setKeyOf(t,e)},FeModel.prototype.getIdOf=function(t){return this._objects.getKeyOf(t)},FeModel.prototype.setLabelOf=function(t,e){this._objects.setLabelOf(t,e)},FeModel.prototype.getLabelOf=function(t){return this._objects.getLabelOf(t)},FeModel.prototype.findByLabel=function(t){return this._objects.findByLabel(t)},FeModel.prototype.createNode=function(t,e,r){Array.isArray(t)&&(e=t[1],r=t[2],t=t[0]);var o=new FeNode(t,e,r,this);return this._objects.insert(o),o},FeModel.prototype.createElement=function(t){var e=new FeElement(t,this);return this._objects.insert(e),e},FeModel.prototype.assignNodeProperty=function(t,e){var r=this.getCurrentPattern();return r.assignNodeProperty(t,e),this},FeModel.prototype.createNodalLoad=function(t){var e=this.getCurrentPattern();return e.createNodalLoad(t)},FeModel.prototype.assignNodalLoad=function(t){var e=this.getCurrentPattern();return e.assignNodalLoad(t,nodeLoad),this},FeModel.prototype.createElementProperty=function(t){var e=Array.prototype.slice.call(arguments);e.shift();var r;if(/[tT]russ/.test(t)){var o=e.shift(),n=e.shift();r=new TrussElementProperty(this,o,n)}},FeModel.prototype.assignElementProperty=function(t,e){var r=this._elePropGraph;return Array.isArray(t)||(t=[t]),t.forEach(function(t){r.addEdge(t,e)}),this},FeModel.prototype.getNodeProperty=function(t){var e=this.getCurrentPattern();return e.getNodeProperty(t)},FeModel.prototype.createSPC=function(t,e){var r=this.createNodeProperty();return r.setConstraint(t,e),r},FeModel.prototype.assignSPC=function(t,e){return this.assignNodeProperty(t,e),this},FeModel.prototype.createPattern=function(t,e){var r;if(/^[pP]lain$/.test(t))r=new PlainPattern(e,this);else{if(!/^[uU]niform(Excitation)?$/.test(t))throw new Error("Unknown load pattern type "+t+"!");r=new UniformPattern(e,this)}return this.setCurrentPattern(r),r},FeModel.prototype.getCurrentPattern=function(){return this._currentPattern},FeModel.prototype.setCurrentPattern=function(t){var e=getId(t);return"undefined"==typeof this._patterns[e]&&(this._patterns[e]=t),this._currentPattern=t,this},FeModel.prototype.getNodes=function(){return this._nodeEleGraph.getLeftNodes()},FeModel.prototype.getElements=function(){return this._nodeEleGraph.getRightNodes()},FeModel.prototype.forEachNode=function(t,e){this._nodes;this._nodeEleGraph.forEachLeftNode(t,e)},FeModel.prototype.forEachElement=function(t,e){this._elements;this._nodeEleGraph.forEachRightNode(t,e)},FeModel.prototype.getAABB=function(){var t=[1/0,-1/0,1/0,-1/0,1/0,-1/0];return this.forEachNode(function(e){e.x<t[0]?t[0]=e.x:e.x>t[1]&&(t[1]=e.x),e.y<t[2]?t[2]=e.y:e.y>t[3]&&(t[3]=e.y),e.z<t[4]?t[4]=e.z:e.z>t[5]&&(t[5]=e.z)}),t},FeModel.prototype.getXRange=function(){return this.getAABB().slice(0,2)},FeModel.prototype.getYRange=function(){return this.getAABB().slice(2,4)},FeModel.prototype.getZRange=function(){return this.getAABB().slice(4)},FeModel.prototype.getXDiff=function(){var t=this.getXRange();return t[1]-t[0]},FeModel.prototype.getYDiff=function(){var t=this.getYRange();return t[1]-t[0]},FeModel.prototype.getZDiff=function(){var t=this.getZRange();return t[1]-t[0]},FeModel.TOL=1e-8,FeModel.prototype.getDimension=function(){var t=FeModel.TOL,e=0;return e+=this.getXDiff()>t?1:0,e+=this.getYDiff()>t?1:0,e+=this.getZDiff()>t?1:0},FeModel.prototype.toJSON=function(){var t={};return t.id=this.uid(),t.nodes=Object.keys(this._nodes).map(function(t){var e=this[t],r=e.toJSON();return r.id=e.uid(),r},this._nodes),t.elements=Object.keys(this._elements).map(function(t){var e=this[t],r=e.toJSON();return r.id=e.uid(),r},this._elements),t.currentPattern=this._currentPattern.uid(),t.patterns=Object.keys(this._patterns).map(function(t){return this[t].toJSON()},this._patterns),t},FeModel.prototype.setFromJSON=function(){return this},FeModel.prototype.copy=function(t){this.setFromJSON(t.toJSON())},FeModel.prototype.clone=function(){this.setFromJSON(other.toJSON())},FeModel.createFromJSON=function(t){var e=new FeModel;t.id&&(e._uid=t.id);var r=(t.refType||"id",t.nodes);Array.isArray(r)&&r.forEach(function(t){var r=e.createNode(t.x,t.y,t.z);t.id&&r.setId(t.id)});var o=t.elements;return Array.isArray(o)&&o.forEach(function(t){var r=t.nodes.map(function(t){return e.getObject(t)}),o=e.createElement(r);t.id&&o.setId(t.id)}),e},NotImplementedError.prototype=new Error,exports.FeObject=FeObject,exports.FeNode=FeNode,exports.FeElement=FeElement,exports.FeSPC=FeSPC,exports.FeModel=FeModel;var _=require("./core.utils"),cloneDeep=_.cloneDeep,embed=_.embed,check=_.check,assert=_.assert,defineContract=_.defineContract,isMatrixOfDimension=_.isMatrixOfDimension,vectorOfDimension=_.vectorOfDimension,PointSet=require("./geometry.pointset").PointSet,_input_contract_fens_options_=defineContract(function(t){if(assert.object(t),assert.assigned(t.xyz),!(isMatrixOfDimension(t.xyz,"*",1)||isMatrixOfDimension(t.xyz,"*",2)||isMatrixOfDimension(t.xyz,"*",3)||check.instance(t.xyz,PointSet)))throw new Error("Not valid xyz for fens.")},"Input is not a valid fens option.");FeNodeSet.prototype.dim=function(){return this._xyz.getRn()},FeNodeSet.prototype.xyz=function(){return this._xyz.toList()},FeNodeSet.prototype.xyzById=function(t){return this._xyz.get(t-1)},FeNodeSet.prototype.get=FeNodeSet.prototype.xyzById,FeNodeSet.prototype.xyzIter=function(){var t=0,e=this._xyz,r=e.getSize();return{hasNext:function(){return r>t},next:function(){return e.get(t++)}}},FeNodeSet.prototype.xyz3=function(){return this._xyz.embed(3).toList()},FeNodeSet.prototype.xyz3ById=function(t){return embed(this._xyz.get(t-1),3)},FeNodeSet.prototype.xyz3Iter=function(){var t=this.xyzIter();return{hasNext:function(){return t.hasNext()},next:function(){return embed(t.next(),3)}}},FeNodeSet.prototype.count=function(){return this._xyz.getSize()},FeNodeSet.prototype.boxSelect=function(t){function e(t,e){var r,o,n,i,s=t.length,a=!0;for(r=0;s>r;++r)if(o=t[r],n=e[2*r],i=e[2*r+1],n>o||o>i)return!1;return a}if(!t||!t.bounds||t.bounds.length!==2*this.dim())throw new Error("FeNodeSet::boxSelect() invalid options.bounds");var r,o,n=cloneDeep(t.bounds),i=n.length;if("number"==typeof t.inflate)for(o=Math.abs(t.inflate),r=0;i>r;++r)r%2==0?n[r]-=o:n[r]+=o;var s,a,u=(this.dim(),this.nfens()),p=[];for(s=1;u>=s;++s)a=this.xyzById(s),e(a,n)&&p.push(s);return p},FeNodeSet.prototype.nfens=FeNodeSet.prototype.count,exports.FeNodeSet=FeNodeSet;var numeric=require("./core.numeric"),size=numeric.size,eye=numeric.eye,div=numeric.div,norm2=numeric.norm2;exports.genISORm=genISORm,exports.skewmat=skewmat;var _=require("./core.utils"),check=_.check,assert=_.assert,isVectorOfDimension=_.isVectorOfDimension,array2d=_.array2d,array1d=_.array1d,defineContract=_.defineContract,matrixOfDimension=_.contracts.matrixOfDimension,PointSet=require("./geometry.pointset").PointSet,FeNodeSet=require("./fens").FeNodeSet,_input_contract_field_option_=defineContract(function(t){if(assert.object(t),check.assigned(t.values))matrixOfDimension("*","*","values is not a valid matrix.")(t.values);else if(check.assigned(t.nfens)&&check.assigned(t.dim)){if(assert.integer(t.nfens),assert.integer(t.dim),t.nfens<0)throw new Error("nfens must > 0.");if(t.dim<0)throw new Error("dim must > 0")}else if(check.assigned(t.fens))assert.instance(t.fens,FeNodeSet);else{if(!check.assigned(t.pointset))throw new Error("");assert.instance(t.pointset,PointSet)}check.assigned(t.ebcs)&&assert.array(t.ebcs,"ebcs must be a array of valid EBC object")},"Input is not a valid Field option.");Field.prototype.nfens=function(){return this._values.getSize()},Field.prototype.neqns=function(){return this._eqnums||this._numberEqnums_(),this._neqns},Field.prototype.dim=function(){return this._values.getRn()},Field.prototype.values=function(){return this._values.toList()},Field.prototype.isPrescribed=function(t,e){return this._prescribed?this._prescribed[t][e]:!1},Field.prototype.prescribedValue=function(t,e){return this.isPrescribed(t,e)?this._prescribedValues[t][e]:0},Field.prototype.setPrescribedValue_=function(t,e,r){this._prescribed[t][e]=!0,this._prescribedValues[t][e]=r,this._values.setAtDir_(t-1,e-1,r)},Field.prototype._numberEqnums_=function(){var t,e,r=array2d(this.nfens()+1,this.dim()+1,0),o=0,n=this.nfens(),i=this.dim();for(t=1;n>=t;++t)for(e=1;i>=e;++e)this.isPrescribed(t,e)?r[t][e]=0:(o++,r[t][e]=o);this._eqnums=r,this._neqns=o},Field.prototype.eqnum=function(t,e){if(this._eqnums||this._numberEqnums_(),1>t||t>this.nfens())throw new Error("Field::eqnum(): id out of range.");if(1>e||e>this.dim())throw new Error("Field::eqnum(): direction out of range.");return this._eqnums[t][e]},Field.prototype.gatherEqnumsVector=function(t){var e=[],r=this.dim();return t.forEach(function(t){var o;for(o=1;r>=o;++o)e.push(this.eqnum(t,o))},this),e},Field.prototype.gatherValuesMatrix=function(t){var e=t.length,r=(this.dim(),array1d(e,null));return t.forEach(function(t,e){var o=t-1;r[e]=this._values.get(o)},this),r},Field.prototype.gatherPrescirbedValues=function(t){var e=[],r=this.dim();return t.forEach(function(t){var o;for(o=1;r>=o;++o)e.push(this.prescribedValue(t,o))},this),e},Field.prototype.scatterSystemVector_=function(t){var e=this.neqns();if(!isVectorOfDimension(t,e))throw new Error("Field::scatterSystemVector(): vec is not a vector of dimension "+e);this._eqnums||this._numberEqnums_();var r,o,n,i,s=this._eqnums,a=this.nfens(),u=this.dim(),p=this._values;for(r=1;a>=r;++r)for(o=1;u>=o;++o)n=s[r][o],0!==n&&(i=t[n-1],p.setAtDir_(r-1,o-1,i))},exports.Field=Field;var _=require("./core.utils"),uuid=_.uuid,noop=_.noop,defineContract=_.defineContract,assert=_.assert,check=_.check,matrixOfDimension=_.contracts.matrixOfDimension,vectorOfDimension=_.contracts.vectorOfDimension,numeric=require("./core.numeric"),size=numeric.size,norm=numeric.norm,nthColumn=numeric.nthColumn,dot=numeric.dot,transpose=numeric.transpose,feutils=require("./feutils"),skewmat=feutils.skewmat,hypercube=require("./geometry.topology").hypercube;exports.GCellSet=GCellSet,GCellSet.prototype.type=function(){throw new Error("GCellSet::type(): is not implemented.")},GCellSet.prototype.boundaryGCellSetConstructor=function(){throw new Error("GCellSet::getBoundaryGCellSetConstructor(): is not implemented.")},GCellSet.prototype.boundaryCellType=function(){var t=this.boundaryGCellSetConstructor();return t.prototype.type.call(null)},GCellSet.prototype.boundary=function(){var t=this.boundaryGCellSetConstructor(),e=this._topology.boundary();return new t(e)},GCellSet.prototype.dim=function(){throw new Error("GCellSet::dim(): is not implemented.")},GCellSet.prototype.cellSize=function(){throw new Error("GCellSet::cellSize(): is not implemented.")},GCellSet.prototype.nfens=GCellSet.prototype.cellSize,GCellSet.prototype.id=function(){return this._id},GCellSet.prototype.conn=function(){return this._topology.getMaxCells()},GCellSet.prototype.jacobianMatrix=function(t,e){var r=this.cellSize(),o=this.dim();
return matrixOfDimension(r,o,"NodalDerivativesInParametricDomain is not a matrix of "+r+" x "+o)(t),matrixOfDimension(r,o,"NodalCoordinatesInSpatialDomain is not a matix of "+r+" x "+o)(e),numeric.mul(numeric.transpose(e),t)},GCellSet.prototype.bfun=function(){throw new Error("GCellSet::bfun(): is not implemented.")},GCellSet.prototype.bfundpar=function(){throw new Error("GCellSet::bfundpar(): is not implemented.")};var _input_contract_funct_bfundsp_=function(t,e){return defineContract(function(r,o){matrixOfDimension(t,e,"NodalDerivativesInParametricDomain is not a matrix of "+t+" x "+e)(r),matrixOfDimension(t,e,"NodalCoordinatesInSpatialDomain is not a matix of "+t+" x "+e)(o)},"Input is invalid for bfundsp")},_contract_funct_J_=function(t){return defineContract(function(e){matrixOfDimension(t,t)(e)},"J is not a matrix of "+t+" x "+t)},_output_contract_funct_bfundsp_=function(t,e){return defineContract(function(r){matrixOfDimension(t,e)(r)},"Output is invalid for bfunsp, it is not "+t+" by "+e)};GCellSet.prototype.bfundsp=function(t,e){var r=this.cellSize(),o=this.dim();_input_contract_funct_bfundsp_(r,o)(t,e);var n=numeric.mul(numeric.transpose(e),t);_contract_funct_J_(o)(n);var i=numeric.dot(t,numeric.inv(n));return _output_contract_funct_bfundsp_(r,o)(i),i},GCellSet.prototype.cat=function(){throw new Error("GCellSet::cat(): is not implemented.")},GCellSet.prototype.count=function(){return this._topology.getNumOfCellsInDim(this._topology.getDim())},GCellSet.prototype.size=GCellSet.prototype.count,GCellSet.prototype.nfens=function(){return this._topology.getNumOfCellsInDim(0)},GCellSet.prototype.isInParametric=function(){throw new Error("GCellSet::isInParametric(): is not implemented.")},GCellSet.prototype.map2parametric=function(){throw new Error("GCellSet::map2parametric(): is not implemented.")},GCellSet.prototype.subset=function(){throw new Error("GCellSet::subset(): is not implemented.")},GCellSet.prototype.clone=function(){throw new Error("GCellSet::clone(): is not implemented.")},GCellSet.prototype.updateConnectivity=function(){throw new Error("GCellSet::updateConnectivity(): is not implemented.")},Manifold1GCellSet.prototype=Object.create(GCellSet.prototype),Manifold1GCellSet.prototype.constructor=Manifold1GCellSet,Manifold1GCellSet.prototype.dim=function(){return 1},Manifold1GCellSet.prototype.otherDimension=function(t,e,r){return"function"==typeof this._otherDimension?this._otherDimension(t,e,r):this._otherDimension},Manifold1GCellSet.prototype.axisSymm=function(){return this._axisSymm};var _input_contract_m1_jac_=_.defineContract(function(t,e,r,o){},"input is not valid for mainfold 1 gcellset jacobian."),_output_contract_jac_=_.defineContract(function(t){assert.number(t)},"jac is not a number");Manifold1GCellSet.prototype.jacobian=function(t,e,r,o){_input_contract_m1_jac_(t,e,r,o);var n=this.jacobianCurve(t,e,r,o);return _output_contract_jac_(n),n},Manifold1GCellSet.prototype.jacobianCurve=function(t,e,r,o){_input_contract_m1_jac_(t,e,r,o);var n=numeric.transpose(r)[0],i=numeric.norm2(n);return _output_contract_jac_(i),i},Manifold1GCellSet.prototype.jacobianSurface=function(t,e,r,o){_input_contract_m1_jac_(t,e,r,o);var n;if(this.axisSymm()){var i=this.cellSize(),s=this.dim();matrixOfDimension(i,1)(e),matrixOfDimension(i,s)(o);var a=numeric.mul(numeric.transpose(e),o)[0];n=2*this.jacobianCurve(t,e,r,o)*Math.PI*a[0]}else n=this.jacobianCurve(t,e,r,o)*this.otherDimension(t,e,o);return _output_contract_jac_(n),n},Manifold1GCellSet.prototype.jacobianVolumn=function(t,e,r,o){_input_contract_m1_jac_(t,e,r,o);var n;if(this.axisSymm()){var i=(this.cellSize(),this.dim(),numeric.mul(numeric.transpose(e),o)[0]);n=2*this.jacobianCurve(t,e,r,o)*Math.PI*i[0]*this.otherDimension(t,e,o)}else n=this.jacobianCurve(t,e,r,o)*this.otherDimension(t,e,o);return _output_contract_jac_(n),n},Manifold1GCellSet.prototype.jacobianInDim=function(t,e,r,o,n){_input_contract_m1_jac_(t,e,r,o);var i;switch(n){case 3:i=this.jacobianVolumn(t,e,r,o);break;case 2:i=this.jacobianSurface(t,e,r,o);break;case 1:i=this.jacobianCurve(t,e,r,o);break;default:throw new Error("Manifold1GCellSet::jacobianInDim(): wrong dimension "+n)}return _output_contract_jac_(i),i},exports.Manifold2GCellSet=Manifold2GCellSet,Manifold2GCellSet.prototype=Object.create(GCellSet.prototype),Manifold2GCellSet.prototype.constructor=Manifold2GCellSet,Manifold2GCellSet.prototype.dim=function(){return 2},Manifold2GCellSet.prototype.otherDimension=function(t,e,r){return"function"==typeof this._otherDimension?this._otherDimension(t,e,r):this._otherDimension},Manifold2GCellSet.prototype.axisSymm=function(){return this._axisSymm},Manifold2GCellSet.prototype.jacobian=function(t,e,r,o){return this.jacobianSurface(t,e,r,o)},Manifold2GCellSet.prototype.jacobianInDim=function(t,e,r,o,n){switch(n){case 3:return this.jacobianVolumn(t,e,r,o);case 2:return this.jacobianSurface(t,e,r,o);default:throw new Error("Manifold2GCellSet::jacobianInDim(): unsupported dim "+n)}},Manifold2GCellSet.prototype.jacobianSurface=function(t,e,r){var o,n=size(r),i=n[0],s=n[1];if(2!==s)throw new Error("Manifold2GCellSet::jacobianSurface(): is not implemented when ntan is not 2");return i===s?o=r[0][0]*r[1][1]-r[1][0]*r[0][1]:(o=skewmat(nthColumn(r,1)),o=dot(o,nthColumn(r,2)),o=norm(o)),o},Manifold2GCellSet.prototype.jacobianVolumn=function(t,e,r,o){var n,i;return this.axisSymm()?(n=dot(transpose(e),o),i=2*this.jacobianSurface(t,e,r,o)*Math.PI*n[0]):i=this.jacobianSurface(t,e,r,o)*this.otherDimension(t,e,o),i};var _input_contract_gcellset_=defineContract(function(t){assert.object(t),assert.assigned(t.conn),matrixOfDimension("*","*")(t.conn)},"input is not a valid gcellset option."),_input_contract_L2_=defineContract(function(t){_input_contract_gcellset_(t),matrixOfDimension("*",2)(t.conn),check.assigned(t.otherDimension)&&assert.number(t.otherDimension),check.assigned(t.axisSymm)&&assert["boolean"](t.axisSymm)},"input is not a valid L2 option.");L2.prototype=Object.create(Manifold1GCellSet.prototype),L2.prototype.constructor=L2,L2.prototype.boundaryGCellSetConstructor=function(){return P1},L2.prototype.subset=function(t){var e=subset(this.conn(),t);return new L2({conn:e,axisSymm:this.axisSymm(),otherDimension:this._otherDimension})},L2.prototype.cellSize=function(){return 2},L2.prototype.type=function(){return"L2"};var _input_contract_l2_param_coords_=defineContract(function(t){vectorOfDimension(1)(t)},"input is not a valid l2 param coords, which should be of vector of dimension 1.");L2.prototype.bfun=function(t){_input_contract_l2_param_coords_(t);var e=t[0],r=[[.5*(1-e)],[.5*(1+e)]];return r},L2.prototype.bfundpar=function(t){return _input_contract_l2_param_coords_(t),[[-.5],[.5]]},exports.L2=L2,exports.Q4=Q4,Q4.prototype=Object.create(Manifold2GCellSet.prototype),Q4.prototype.constructor=Q4,Q4.prototype.subset=function(t){var e=subset(this.conn(),t);return new Q4({conn:e,axisSymm:this.axisSymm(),otherDimension:this._otherDimension})},Q4.prototype.cellSize=function(){return 4},Q4.prototype.type=function(){return"Q4"},Q4.prototype.boundaryGCellSetConstructor=function(){return L2},Q4.prototype.bfun=function(t){var e=1-t[0],r=1+t[0],o=1-t[1],n=1+t[1],i=[[.25*e*o],[.25*r*o],[.25*r*n],[.25*e*n]];return i},Q4.prototype.bfundpar=function(t){var e=t[0],r=t[1],o=[[.25*-(1-r),.25*-(1-e)],[.25*(1-r),.25*-(1+e)],[.25*(1+r),.25*(1+e)],[.25*-(1+r),.25*(1-e)]];return o};var _=require("./core.utils");PointSet.prototype.getSize=function(){return this._points.length},PointSet.prototype.__defineGetter__("size",PointSet.prototype.getSize),PointSet.prototype.getRn=function(){return this._rn},PointSet.prototype.__defineGetter__("rn",PointSet.prototype.getRn),PointSet.prototype.clone=function(){return new PointSet(this.toList(),this.rn)},PointSet.prototype.toJSON=function(){var t={};return t.points=this.toList(),t.rn=this.rn,t},PointSet.prototype.toList=function(){return _.cloneDeep(this._points)},PointSet.prototype.equals=function(t){if(this.rn!==t.rn||this.size!==t.size)return!1;var e,r,o=this.size,n=this.rn;for(e=0;o>e;e+=1){var i=this.get(e),s=t.get(e);for(r=0;n>r;++r)if(i[r]!==s[r])return!1}return!0},PointSet.prototype.isEqualTo=PointSet.prototype.equals,PointSet.prototype.get=function(t){if(t>=0&&t<this._points.length)return this._points[t].slice();throw new Error("PointSet::get() index outof bounds.")},PointSet.prototype.set_=function(t,e){if(t>=0&&t<this._points.length){if(e.length!==this.rn)throw new Error("PointSet::set() point dimension is not matched.");var r=this._points;return void _.each(r[t],function(o,n){r[t][n]=e[n]})}throw new Error("PointSet::set() index outof bounds.")},PointSet.prototype.setAtDir_=function(t,e,r){if(0>e||e>=this.getRn())throw new Error("PointSet::setAtDir_() dir is out of range.");if(t>=0&&t<this._points.length){var o=this._points;return void(o[t][e]=r)}throw new Error("PointSet::set() index outof bounds.")},PointSet.prototype.forEach=function(t){var e,r,o;for(e=0,r=this.getSize();r>e;++e)o=this.get(e),t(o,e)},PointSet.prototype.map=function(t){var e=new Array(this.getSize());return this.forEach(function(r,o){e[o]=t(r,o)}),new PointSet(e)},PointSet.prototype.filter=function(t){var e=[];return this.forEach(function(r,o){t(r,o)&&e.push(r)}),new PointSet(e,this._rn)},PointSet.prototype.embed=function(t){return this.map(function(e){return _.embed(e,t)})},PointSet.prototype.extrude=function(t){var e=t.reduce(function(t,e){var r=t[t.length-1];return t.push(r+e),t},[0]),r=this.rn,o=this._points,n=_.reduce(e,function(t,e){return _.each(o,function(r){var o=_.clone(r);o.push(e),t.push(o)}),t},[]);return new PointSet(n,r+1)},PointSet.prototype.findOne=function(t){var e,r,o=this.getSize();for(e=0;o>e;++e)if(r=this.get(e),t(r,e)===!0)return r;return null},PointSet.prototype.contains=function(t,e){var r=e||PointSet.DEFAULT_PRECISION;return _.isArray(t)&&t.length===this.rn?null!==this.findOne(function(e){return _.norm2(_.sub(e,t))<r}):!1},PointSet.prototype.merged=function(t){var e=t||PointSet.DEFAULT_PRECISION,r=[];return this.forEach(function(t){var o=_.any(r,function(r){return _.norm2(t,r)<e});o||r.push(t)}),new PointSet(r,this.rn)},PointSet.DEFAULT_PRECISION=1e-6,PointSet.prototype.combineWith=function(t){if(this.rn!==t.rn)throw new Error("Pointset::combineWith(other): pointset rn dismatch.");var e=this.toList();return t.forEach(function(t){e.push(t)}),new PointSet(e,this.rn)},PointSet.prototype.fuse=PointSet.prototype.combineWith,PointSet.prototype.rotate=function(){throw new Error("PointSet::rotate(dims, values) is not implemented")},PointSet.prototype.scale=function(t,e){if(_.isArray(t)&&_.isArray(e)&&t.length===e.length){if(_.max(t)+1>this.rn)throw new Error("PointSet::scale(dims, values): dim must be no greater than rn.");return this.map(function(r){return t.forEach(function(t,o){r[t]=r[t]*e[o]}),r})}throw new Error("PointSet::scale(dims, values): dims and values must be array of same length.")},PointSet.prototype.translate=function(t,e){if(_.isArray(t)&&_.isArray(e)&&t.length===e.length){if(_.max(t)+1>this.rn)throw new Error("PointSet::translate(dims, values): dim must be no greater than rn.");return this.map(function(r){return t.forEach(function(t,o){r[t]=r[t]+e[o]}),r})}throw new Error("PointSet::translate(dims, values): dims and values must be array of same length.")},PointSet.prototype.transform=function(){throw new Error("PointSet::transform(matrix) is not implemented")},PointSet.prototype.prod=function(){throw new Error("PointSet::prod(other) is not implemented.")},exports.PointSet=PointSet;var _=require("./core.utils"),array1d=_.array1d,cloneDeep=_.cloneDeep,normalizedCell=_.normalizedCell,byLexical=_.byLexical,Bimap=_.Bimap;Topology.prototype.getDim=function(){return this._complexes.length-1},Topology.prototype.__defineGetter__("dim",Topology.prototype.getDim),Topology.prototype.getNumOfCellsInDim=function(t){if(0>t||t>this.getDim())throw new Error("Topology::getNumOfCellsInDim(): dim out of bound.");return this._complexes[t].length},Topology.prototype.getCellSizeInDim=function(t){if(0>t||t>this.getDim())throw new Error("Topology::getCellSizeInDim(): dim out of bound.");return this._cellSizes[t]},Topology.prototype.toList=function(){return _.cloneDeep(this._complexes)},Topology.prototype.toJSON=function(){return{complexes:this.toList()}},Topology.prototype.clone=function(){var t=new Topology([]);return t._complexes=this.toList(),t._cellSizes=_.cloneDeep(this._cellSizes),t},Topology.prototype.normalized=function(){var t=cloneDeep(this._complexes);return t.forEach(function(t){t.forEach(function(e,r){t[r]=normalizedCell(e)}),t.sort(byLexical)}),new Topology(t,this._cellSizes)},Topology.prototype.equals=function(t){if(this.getDim()!==t.getDim())return!1;var e,r=this.getDim();for(e=0;r>=e;++e)if(this.getCellSizeInDim(e)!==t.getCellSizeInDim(e))return!1;var o,n;for(e=0;r>=e;++e)for(n=this.getNumOfCellsInDim(e),o=0;n>o;++o)if(!_.isEqual(this._complexes[e][o],t._complexes[e][o]))return!1;return!0},Topology.prototype.getCellsInDim=function(t){return _.cloneDeep(this._complexes[t])},Topology.prototype.getMaxCells=function(){return this.getCellsInDim(this.getDim())},Topology.prototype.boundary=function(){throw new Error("Topology::boundary(): is not implemented.")};var HYPERCUBE_DIM_CELLSIZE_BIMAP=new Bimap([[0,1],[1,2],[2,4],[3,8]]);simplex.prototype=Object.create(Topology.prototype),simplex.prototype.constructor=simplex,exports.Topology=Topology,exports.hypercube=hypercube,exports.simplex=simplex;var _=require("./core.utils");_.assign(exports,require("./core.bimap")),_.assign(exports,require("./core.bipartite")),_.assign(exports,require("./core.setstore")),_.assign(exports,require("./femodel")),exports._=_,exports.numeric=require("./core.numeric"),exports.geometry={pointset:require("./geometry.pointset"),topology:require("./geometry.topology")},exports.feutils=require("./feutils"),exports.fens=require("./fens"),exports.gcellset=require("./gcellset"),exports.field=require("./field"),exports.property=require("./property"),exports.material=require("./material"),exports.feblock=require("./feblock"),exports.system=require("./system"),exports.nodalload=require("./nodalload"),exports.integrationrule=require("./integrationrule"),exports.ebc=require("./ebc"),exports.mesh=require("./mesh");var _=require("./core.utils"),numeric=require("./core.numeric"),transpose=numeric.transpose,cloneDeep=_.cloneDeep;IntegrationRule.prototype.paramCoords=function(){throw new Error("IntegrationRule::paramCoords(): must be overrided by subclass.")},IntegrationRule.prototype.weights=function(){throw new Error("IntegrationRule::weights(): must be overrided by subclass.")},IntegrationRule.prototype.npts=function(){throw new Error("IntegrationRule::npts(): must be overrided by subclass.")},IntegrationRule.prototype.dim=function(){throw new Error("IntegrationRule::dim(): must be overrided by subclass.")},exports.IntegrationRule=IntegrationRule,GaussRule.prototype=Object.create(IntegrationRule.prototype),GaussRule.prototype.constructor=GaussRule,GaussRule.prototype.paramCoords=function(){return cloneDeep(this._paramCoords)},GaussRule.prototype.weights=function(){return cloneDeep(this._weights)},GaussRule.prototype.npts=function(){return this._paramCoords.length},GaussRule.prototype.dim=function(){return this._paramCoords[0].length},exports.GaussRule=GaussRule;var _=require("./core.utils"),check=_.check,assert=_.assert,defineContract=_.defineContract,property=require("./property"),LinElIso=property.LinElIso,numeric=require("./core.numeric"),ix=numeric.ix,ixUpdate=numeric.ixUpdate,mul=numeric.mul,div=numeric.div,dot=numeric.dot,add=numeric.add;Material.prototype.newState=function(){throw new Error("Material::newState(): is not implemented.")},Material.prototype.update=function(){throw new Error("Material::update(): is not implemented.")},exports.Material=Material;var _input_contract_linel_uniax_prop_=defineContract(function(t){if(assert.object(t),!check.instance(t.property,LinElIso))throw new Error("input is not a instance of LinElIso.")},"Input is not a valid option for DeforSSLinElUniax");DeforSSLinElUniax.prototype=Object.create(Material.prototype),DeforSSLinElUniax.prototype.constructor=DeforSSLinElUniax,DeforSSLinElUniax.prototype.tangentModuli=function(){return[[this._prop.E()]]},exports.DeforSSLinElUniax=DeforSSLinElUniax;var _input_contract_linel_biax_prop_=defineContract(function(t){if(assert.object(t),!check.instance(t.property,LinElIso))throw new Error("input is not a instance of LinElIso.")},"Input is not a valid option for DeforSSLinElBiax");exports.DeforSSLinElBiax=DeforSSLinElBiax,DeforSSLinElBiax.prototype=Object.create(Material.prototype),DeforSSLinElBiax.prototype.constructor=DeforSSLinElBiax,DeforSSLinElBiax.prototype.tangentModuli=function(){var t,e,r=this._prop.D();if("strain"===this._reduction)t=ix(r,[1,2,4],[1,2,4]);else if("axisSymm"===this._reduction)t=ix(r,[1,2,3,4],[1,2,3,4]);else{if("stress"!==this._reduction)throw new Error("DeforSSLinElBiax::tangentModuli() is ");e=ix(r,[1,2],[1,2]),e=add(e,mul(-1,div(dot(ix(r,[1,2],[3]),ix(r,[3],[1,2])),r[2][2]))),t=ix(r,[1,2,4],[1,2,4]),t=ixUpdate(t,[1,2],[1,2],e)}return t};var FeNodeSet=require("./fens").FeNodeSet,Q4=require("./gcellset").Q4;exports.L2x2=L2x2;var _=require("./core.utils"),check=_.check,ElementVector=require("./system.vector").ElementVector;NodalLoad.prototype.loads=function(t){var e,r,o,n,i,s,a=this._ids.length,u=this._dirs.length,p=[],c=[];for(e=0;a>e;++e)for(n=this._ids[e],r=0;u>r;++r)i=this._dirs[r],o=t.eqnum(n,i),s=this._magns[r],p.push(s),c.push(o);return new ElementVector(p,c)},exports.NodalLoad=NodalLoad;var _=require("./core.utils"),assert=_.assert,check=_.check,matrixOfDimension=_.contracts.matrixOfDimension,mat6x6=matrixOfDimension(6,6),diag=_.numeric.diag,transpose=_.numeric.transpose,add=_.numeric.add,dot=_.numeric.dot,mul=_.numeric.mul;MaterialProperty.prototype.rho=function(){return this._rho},exports.MaterialProperty=MaterialProperty;var _input_contract_LinElIsoProp_=_.defineContract(function(t){if(assert.object(t,"props is not a JS object"),assert.undefined(t.G,"props.G should not be set, it is compute from E and nu."),assert.positive(t.E,"props.E is not a positive number."),check.assigned(t.nu)&&(assert.number(t.nu,"props.nu is not a number."),t.nu<0))throw new Error("props.nu < 0.")},"input is not a valid linear elasitc iso property.");exports.LinElIso=LinElIso,LinElIso.prototype=Object.create(MaterialProperty.prototype),LinElIso.prototype.constructor=LinElIso,LinElIso.prototype.E=function(){return this._E},LinElIso.prototype.nu=function(){return this._nu},LinElIso.prototype.G=function(){return this._G||(this._G=.5*this._E/(1+this._nu)),this._G};var _output_contract_D_=mat6x6;LinElIso.prototype.D=function(){if(!this._D){var t=this.E(),e=this.nu(),r=(this.G(),t*e/((1+e)*(1-2*e))),o=t/(2*(1+e)),n=diag([1,1,1,.5,.5,.5]),i=transpose([[1,1,1,0,0,0]]);this._D=add(mul(r,dot(i,transpose(i))),mul(2*o,n))}return _output_contract_D_(this._D),this._D};var _=require("./core.utils"),isVector=_.isArray,matrix=require("./system.matrix"),vector=require("./system.vector"),SparseSystemMatrix=matrix.SparseSystemMatrix,SparseSystemVector=vector.SparseSystemVector;exports.matrix=matrix,exports.vector=vector,exports.mldivide=mldivide;var _=require("./core.utils"),iteratorFromList=_.iteratorFromList,isArray=_.isArray,isIterator=_.isIterator,numeric=require("./core.numeric"),mldivide=numeric.mldivide,DokSparseMatrix=numeric.DokSparseMatrix;exports.ElementMatrix=ElementMatrix,SparseSystemMatrix.prototype._assemble_=function(){this._dokMatrix=new DokSparseMatrix([],this._nrows,this._ncols),assemble_(this._dokMatrix,this._kes)},SparseSystemMatrix.prototype.dokMatrix=function(){return null==this._dokMatrix&&this._assemble_(),this._dokMatrix},SparseSystemMatrix.prototype.toFull=function(){return this.dokMatrix().toFull()},SparseSystemMatrix.prototype.mldivide=function(t){var e=this.dokMatrix();return mldivide(e,t)},exports.SparseSystemMatrix=SparseSystemMatrix;var _=require("./core.utils"),iteratorFromList=_.iteratorFromList,isArray=_.isArray,isIterator=_.isIterator,numeric=require("./core.numeric"),SparseVector=numeric.SparseVector;exports.ElementVector=ElementVector,exports.SparseSystemVector=SparseSystemVector,SparseSystemVector.prototype._assemble_=function(){var t=this._evs,e=new SparseVector([],this._dim);if(!isIterator(t)){if(!isArray(t))throw new Error("SparseSystemVector::_assemble_: evs must be a iterator or array.");t=iteratorFromList(t)}for(var r,o,n;t.hasNext();)r=t.next(),o=r.vector,n=r.eqnums,n.forEach(function(t,r){if(0!==t){var n=o[r],i=t-1,s=e.at(i);e.set_(i,s+n)}});this._sparseVector=e},SparseSystemVector.prototype.sparseVector=function(){return null===this._sparseVector&&this._assemble_(),this._sparseVector},SparseSystemVector.prototype.toFull=function(){return this.sparseVector().toFull()};